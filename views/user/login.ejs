<h2 class="page-header">Login </h2>
<form id="login" method="POST" action="">
  <div class="form-row">
    <div class="form-item">
      <label style="text-align:left;">Username</label>
      <br>
      <input type="text" autocomplete="off" id="username" placeholder="Username">
      <br>
      <label style="text-align:left;">Password</label>
      <br>
      <input type="password" autocomplete="off" id="password" placeholder="Password">
    </div>
  </div>
  <div class="form-row form-row-end">
    <a class= "btn btn-primary" href="/user/register" >Register</a>
    <button class="btn btn-primary" type="submit">Login</button> 
  </div>
</form>

<script>
  const form = document.getElementById('login')
  form.addEventListener('submit', login)

  async function login(event) {
    console.log("hey you win")
    event.preventDefault()
    const username = document.getElementById('username').value
    const password = document.getElementById('password').value

    const result = await fetch('/user/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username,
        password
      })
    }).then((res) => res.json())

    if (result.status === 'ok') {
      // everythign went fine
      console.log('Got the token: ', result.data)
      console.log('Heres full body: ', result)
      localStorage.setItem('token', result.data)
      alert('Success')
      location.href="/user/home"
    } else {
      alert(result.error)
    }
  }
</script>
